<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="ICSFuzz is a blackbox fuzzer to efficiently and effectively discover the ICSs in the driving simulator.">
<meta name="keywords" content=" sample homepage">
<title>ICSFuzz | ICSFuzz</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">



    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> ICSFuzz</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			
<!-- <li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:tomjoht@gmail.com?subject=ICSFuzz feedback&body=I have some feedback about the ICSFuzz page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

 -->

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="ICSFuzz">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>



<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle"> </li>
  
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>



            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">ICSFuzz</h1>
</div>



<div class="post-content">

   
    <div class="summary">ICSFuzz is a blackbox fuzzer to efficiently and effectively discover the ICSs in the driving simulator.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})

});
</script>

<div id="toc"></div>



    


    

    <a target="_blank" rel="noopener" href="https://github.com/tomjoht/documentation-theme-jekyll/blob/gh-pages/index.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

   <!-- 
<div markdown="span" class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> If you're cloning this theme, you're probably writing documentation of some kind. I have a blog on technical writing here called <a alt='technical writing blog' href='http://idratherbewriting.com'>I'd Rather Be Writing</a>. If you'd like to stay updated with the latest trends, best practices, and other methods for writing documentation, consider <a href='https://tinyletter.com/tomjoht'>subscribing</a>. I also have a site on <a href='http://idratherbewriting.com/learnapidoc'>writing API documentation</a>.</div>



 -->

<h2 id="discovered-icss">Discovered ICSs</h2>
<p>The developer acknowledged the bug and claimed the partial fix.
The bug was also assigned a CVE ID, which will be updated after the paper review.</p>

<table>
  <thead>
    <tr>
      <th>#No.</th>
      <th>Scenario</th>
      <th>Description</th>
      <th>Bug Report</th>
      <th>Video</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ICS 01</td>
      <td>Follow Leading Bicycle</td>
      <td>The left corner of vehicle collide with the bicycle, the motion state of bicycle significantly changed.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues01</a></td>
      <td><a href="https://youtu.be/90UjwbenwmQ">Video</a></td>
    </tr>
    <tr>
      <td>ICS 02</td>
      <td>Follow Leading Bicycle</td>
      <td>The head center of the vehicle hit the bicycle, sending it flying.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues02</a></td>
      <td><a href="https://youtu.be/UP5NdyNeXls">Video</a></td>
    </tr>
    <tr>
      <td>ICS 03</td>
      <td>Follow Leading Vehicle</td>
      <td>The left front corner of the rear vehicle hit the right rear corner of the front vehicle.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues03</a></td>
      <td><a href="https://youtu.be/aSOXJVpqIEg">Video</a></td>
    </tr>
    <tr>
      <td>ICS 04</td>
      <td>Lane Change</td>
      <td>The left front corner of the rear vehicle hit the right rear corner of the front vehicle.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues04</a></td>
      <td><a href="https://youtu.be/SLZ7hAyEQ70">Video</a></td>
    </tr>
    <tr>
      <td>ICS 05</td>
      <td>Lane Change</td>
      <td>The head of the rear vehicle scrape with the rear bumper of the front vehicle.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues05</a></td>
      <td><a href="https://youtu.be/DfkYDoVsYQM">Video</a></td>
    </tr>
    <tr>
      <td>ICS 06</td>
      <td>Intersection Collision</td>
      <td>The rear end of one vehicle scraped vertically against the left front corner of another vehicle’s front end.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues06</a></td>
      <td><a href="https://youtu.be/Pw8WLTboDt8">Video</a></td>
    </tr>
    <tr>
      <td>ICS 07</td>
      <td>Intersection Collision</td>
      <td>The body of one vehicle scraped vertically against the front end of another vehicle as it passed by.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues07</a></td>
      <td><a href="https://youtu.be/ClFrdoWaYvw">Video</a></td>
    </tr>
    <tr>
      <td>ICS 08</td>
      <td>Pedestrian Standing Front</td>
      <td>The body of the vehicle grazed against the pedestrian as it drove by, knocking the pedestrian down.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues08</a></td>
      <td><a href="https://youtu.be/sk1ajuxKcxI">Video</a></td>
    </tr>
    <tr>
      <td>ICS 09</td>
      <td>Pedestrian Standing Front</td>
      <td>The front bumper scraped the vehicle down.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues09</a></td>
      <td><a href="https://youtu.be/3tkwENfjc_s">Video</a></td>
    </tr>
    <tr>
      <td>ICS 10</td>
      <td>Pedestrian Crossing Front</td>
      <td>The rear of the vehicle knocked down the pedestrian who was in motion.</td>
      <td><a href="https://github.com/carla-simulator/carla/issues/7025">issues10</a></td>
      <td><a href="https://youtu.be/m1ujUC1OudI">Video</a></td>
    </tr>
  </tbody>
</table>

<p><br />
<br />
<br /></p>

<h2 id="case-study">Case Study</h2>

<p><img src="images/case_study_flb.png" alt="image" /></p>

<p><strong>ICS 01:</strong>
As shown in the Figure above, a clear collision occurred from <em>t2</em>, and the NPC bicycle was knocked down by the vehicle at <em>t3</em>. After the EV departs, the NPC bicycle falls to the ground (<em>t4</em>), resulting in significant damage. 
Notably, the collision detector failed to report the incident throughout the entire sequence.</p>

<p><strong>Safety Consequences:</strong>
If an ADS encounters this collision scenario during testing or development in the simulator, it may prevent the ADS developers from identifying and making necessary improvements to the system. Consequently, when the same ADS is deployed in the real world and encounters similar environmental conditions, it could make the same erroneous decision, potentially leading to a real collision with a cyclist. 
Such incidents could result in severe injuries or even fatalities for the cyclist.</p>

<p>The potential consequences underscore the critical need for robust collision detection mechanisms in the simulator to ensure the safety and reliability of ADS during testing and development, ultimately safeguarding real-world applications.</p>

<p><br />
<br />
<br /></p>
<h2 id="experiment-results">Experiment Results</h2>
<h3 id="single-factors">Single Factors</h3>

<!-- <img src="images/single_feature_speed/speed-bar-FLB.png" alt="My Image" width="50%" align="right" style="margin-left: 20px;"> -->

<p><img src="images/single_feature/single_feature_distance.png" alt="image" /></p>

<p>Overall, the data trend in the final result indicates that the effective search direction for ICS searching of collision distance is towards increasing distance in all scenarios except for PCF, where the direction decreases distance.<br />
In scenario FLB , FLV, LC and PSF, 
there is a significant positive correlation between ICS SR and collision distance.
Similarly, in scenario InC, the overall SR trend remains, with a slight fluctuation in the middle distance range.
In scenario PCF, 
the overall ICS SR exhibits a declining trend as the distance increases.
The reason for the negative correlation in scenario PCF is that the NPC pedestrian is walking in the direction perpendicular to the driving direction of the EV.
As the collision distance increases, the probability of the NPC pedestrian moving out of the collision area also increases.</p>

<p>The overall upward trend aligns with our search direction, and the significant difference in SR observed during the transition from low speed to medium/high speed demonstrates the effectiveness of our search step size.
Moreover, the data trend contradicts the intuition regarding the relationship between collision distances and real collisions. 
Intuitively, one would expect a higher occurrence of collisions when two vehicles are close to each other and one of them changes the driving behavior, suggesting that more ICSs should occur within a close distance.
However, the results reveal that more ICSs are found when the distance between two vehicles is far, with one of them altering their driving behavior.</p>

<p><img src="images/single_feature/single_feature_speed.png" alt="image" /></p>

<p>The experimental results indicate that, although the collision speed parameter does not significantly impact the overall outcomes compared to the other two parameters, a positive correlation still exists between the ICS success rates and collision speed in most scenarios.
From Figures above, it can be observed that in most scenarios, there exists a positive trend between collision speed and the final ICS SR.
Except for FLV, more ICS were discovered while collision speed was at the middle range.</p>

<p>The data illustrates that more ICSs are found when the collision speed is high, which aligns with our search direction and illustrates that our search steps effectively detect ICSs.
Our empirical study reveals that, in reality, a higher number of collisions occur at low collision speeds, where one would expect a more significant presence of ICSs. 
However, contrary to this expectation, our experimental results 
are in the opposite direction in most scenarios about the collision factor speed, which demonstrates that more ICSs are found when the collision speed is middle and high. 
The distinction may be because, at high collision speeds, the collision detector lacks sufficient time to react and detect the collision accurately, leading to a higher proportion of ignored collisions.</p>

<p><img src="images/single_feature/single_feature_angle.png" alt="image" /></p>

<p>The data trends of ICS SR related to angle in different scenarios align with the trend of high on both sides and low in the middle. 
The fluctuations in the data result from some specific environmental settings.</p>

<p>Overall, for collision angle values greater than 0, a positive correlation between the collision angle and the final ISC SR is observed in almost all scenarios except for scenarios in FLV, indicating its effectiveness in detecting ICS.
The data trend of scenarios in FLV with the positive angle range exhibits fluctuations. 
One reason is that many scenarios close to ICS are happened when the angle is near 0.</p>

<p>For collision angle values smaller than 0, the ICS SR trends of most scenarios also match our conclusion derived from the study, except for PSF and FLV.
For scenario PSF, it does not have ICS when the collision angle is negative since the pedestrian is standing in the right front of the EV.
In scenario FLV, the peak observed in the negative angle range can also be attributed to a higher number of occurrences of type 3 ICS within the specific angle range.
The decreasing trend observed as the collision angle approaches $-1$ is due to the scenarios being at the border between collision and non-collision, leading to a decrease in both the number of collisions and the corresponding number of ICSs.</p>

<p>The search direction for collision angle is from -1 or 1 to 0 (-90° or 90° to 0° in Figure related to control parameters in the paper).<br />
The steep slope of the data trend demonstrates the effectiveness of the search direction and search steps obtained from our study.
However, the collision frequency trend in reality is the opposite; there are more collisions when the collision angle is close to 0, given that the “Vehicle State While Colliding” has the highest proportion of vehicles moving straight ahead.
The reason for such counter-intuition distinction is that collision angles near 0 often result in a stronger collision force, making them less likely to be missed by the collision detector. 
Conversely, collision angles approaching 1 and -1 (-90° and 90°) encompass a broader range of collision and non-collision scenarios, leading to more identified ICSs.</p>

<h3 id="multiple-factors">Multiple Factors</h3>

<p><img src="images/multi_features/multi_feature_distance-speed.png" alt="image" /></p>

<p>Relationship between ICS SR and Collision Distance at Different Collision Speed Scope.</p>

<p><img src="images/multi_features/multi_feature_speed-distance.png" alt="image" /></p>

<p>Relationship between ICS SR and Collision Speed at Different Collision Distance Scope.</p>

<p><img src="images/multi_features/multi_feature_distance-angle.png" alt="image" /></p>

<p>Relationship between ICS SR and Collision Angle at Different Collision Speed Scope.
<img src="images/multi_features/multi_feature_speed-angle.png" alt="image" /></p>

<p>Relationship between ICS SR and Collision Angle at Different Distance.</p>

<p>\textbf{Q1. Does the search direction for collision speed change at different collision distances?}
<!-- % no, collision speed still doesn't have a large impact compared with collision distance -->
From Figure of relationship between ICS SR and collision distance at different collision speed scope, when examining three specific collision distance groups, the trend for three different collision speed groups remains relatively consistent compared to not considering the collision distance.</p>

<p>\textbf{Q2. Does the search direction for collision distance change at different collision speed scopes?}
Figure of relationship between ICS SR and collision speed at different collision distance scope shows the trends in the SR across different collision distances for three collision speed scopes.
The observed patterns strongly support the conclusion made above regarding the impact of collision distance as a single feature.
In most scenarios, a high collision speed consistently results in more ICSs when combined with a far collision distance.
Except for PCF, a combination of close collision distance and high collision speed leads to more identified ICSs.</p>

<p>\textbf{Q3. Does the search direction for collision angle change at different collision speed scopes?}
The relationship between ICS occurrences and the collision angle, as depicted in Figure of relationship between ICS SR and collision angle at different collision speed scope, remains largely unchanged across different collision speed conditions compared to the trend without considering the effect of collision speed.
The effective search directions for the collision angle remain consistent across different speed scopes, similar to when considering the collision angle independently. 
In scenario InC, a distinct data trend difference at low collision speed is observed at positive collision angles.
However, since the pattern is not observed in other scenarios, it is likely attributed to data noise.</p>

<p>\textbf{Q4. Does the search direction for collision angle change at different collision distance scopes?}</p>

<p>When considering the variations of collision angle across different collision distances, the observed data trend differs slightly from considering collision angle alone.
In scenarios LC, PSF, and InC, the data aligns with the trend of increasing collision angle, bringing more ICSs.
Similarly, although there are fewer fluctuations in the middle collision distance scope in scenario FLV, the overall trend still holds. 
Moreover, the SR exhibits a higher slope at greater collision distances, indicating that simultaneously increasing both collision distance and collision angle can lead to more ICSs.</p>

<p>In scenario FLB, the relationship between collision angle and final SR is unstable and exhibits significant fluctuations under far collision distances.</p>

<p>For collision in middle and far distances, the trend similar to the total trend in general. 
But the middle collision distance brings more ICS.
When considering the collision distance and collision angle together, the middle collision distance and the collision angle close to -1 and 1 create more ICSs.</p>

<p>In scenario PCF, exceptions also occur at low collision distances. 
The exception results in different search directions for PCF at different collision distances compared to the one while angle alone in scenario PCF.
In the low collision distance scope, there are hardly any ICSs for the positive collision angle.
Hence, the search direction should be towards increasing negative collision angles.
Conversely, the situation is reversed in the middle and far collision distance scopes.
There are few collision incidents when the collision angle is negative, the search direction should be towards increasing to the positive collision angles.
The significant occurrence of ICSs in the negative collision angle zone at low collision distances can be attributed to the different relative positions between the EV and the NPC if changed driving behavior at different collision distances.</p>

<p>When driving behavior changes at low collision distances, the pedestrian just steps onto the lane, which corresponds to the negative collision angle region.
In order to collide with the pedestrians, the vehicle needs to veer towards the negative angle region.
On the other hand, at middle to high collision distances, the pedestrian has already reached the region marked by the positive collision angle by the time the EV approaches.
Hence, collision events are more likely to occur in this region.
Generally, collision scenarios with a moderate collision distance and collision angle close to 1, as well as collision scenarios with a low collision distance and negative collision angle, tend to result in a higher number of identified ICSs.</p>

<h3 id="oracle-threshold">Oracle Threshold</h3>
<p><img src="images/oracle_threshold.png" alt="image" /></p>

<p>As we use the object detection bounding box as our oracle for ICS discovery, we aim to investigate whether this oracle is sufficiently reliable and accurate in identifying ICSs.
Therefore, we conducted an ablation study to examine the relationship between threshold and performance and investigate the impact of the IoU threshold on the final ICS results.
Three representative scenarios, FLB, LC, and PSF, are tested, each involving different struck objects.
We explore whether different NPC types affect the TP proportion when the IoU threshold changes.</p>

<p>For scenario FLB, 
We set the collision distance to 3 and the collision speed to 2. The collision angle on the x-axis was fixed at 0.02, while the collision angle on the y-axis varied from 0 to 1 in increments of 0.02. 
Similarly, for scenario LC, we set the collision distance to 5 and the collision speed to 30. The collision angle on the y-axis was fixed at 0.02, and the collision angle on the y-axis ranged from 0 to 1 with a step of 0.02. 
For scenario PSF, we set the collision distance to 2 and the collision speed to 4. The collision angle on the x-axis was fixed at 0, and the collision angle on the y-axis ranged from 0 to 1 with a step of 0.02. 
Each scenario will be run 50 times under the specification above.
The final results have been manually confirmed and presented in Figure above.</p>

<p>The final precision, recall, and the number of true positives are shown in Figure above.
For scenario FLB, involving a bicycle as the NPC, the precision remains relatively consistent for thresholds ranging from 0 to 0.15. However, the recall decreases as the threshold increases, with a significant drop beyond 0.15. The optimal threshold value for FLB is still 0. 
Similarly, for scenario LC with a vehicle as the NPC, the precision is high at thresholds of 0 and 0.2. However,  there is only 1 TP when the threshold is 0.2, the number of true positives exhibits a decreasing trend, and an IoU threshold of 0 yields the best results. In scenario PSF with a pedestrian as the NPC, raising the threshold above 0.05 did not result in additional ICSs. Therefore, setting the threshold at 0 is still the most reasonable choice for our ICS discovery method.</p>

<p><strong>Summary:</strong> Despite the potential false positives in the threshold set for our oracle, ICSFuzz remains highly effective in detecting ICSs according to our empirical evidence.
Additionally, the false positive results may include IC-prone scenarios that hold practical significance, introducing new threats for ADS in real-world scenarios.</p>

<!-- 
### Baseline Comparison

![image](images/baseline_comparison/Drivefuzz-box-log.png)
![image](images/baseline_comparison/ratio_radar.png)


(a) Comparison of time taken to identify ICSs, logarithmically scaled.
    (b) Comparison of time and proportion ratio for three types of ICSs identified by DriveFuzz. -->

<h3 id="drivefuzz-comparison-in-different-modes">DriveFuzz Comparison in different modes</h3>

<table>
  <thead>
    <tr>
      <th><strong>Mutation Mode</strong></th>
      <th><strong>All</strong></th>
      <th><strong>Congestion</strong></th>
      <th><strong>Entropy</strong></th>
      <th><strong>Instability</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Running times</strong></td>
      <td>779</td>
      <td>884</td>
      <td>1976</td>
      <td>893</td>
    </tr>
    <tr>
      <td><strong>Detected ICS</strong></td>
      <td>12</td>
      <td>10</td>
      <td>22</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<p>We also ran DriveFuzz in different modes they offer for 36 hours separately, 
the results are presented in Table above. 
DriveFuzz can merely detect a few ICSs within the limited runtime regardless of the mode used.
DriveFuzz tends to spend more time exploring the non-collision space than exploring further possibilities from the collision space.
It also stops immediately after finding an ICS and then initiates a new round of testing using a new seed scenario.</p>

<p>As a result, DriveFuzz not only misses the opportunity to explore the IC scenario space but also spends more time restarting from a new position in the non-collision scenario space, which is unrelated to the previous round.
Also, the ICSs identified by DriveFuzz, after investing a significant amount of time, exhibit a notable repetition, 
which further highlights the inefficiency of its search strategy.
Comparatively, our incremental search strategy that commences from the collision scenario space has exhibited a discernible superiority.</p>

<p><br />
<br />
<br />
<br />
<br /></p>

<h2 id="empirical-study">Empirical Study</h2>
<h3 id="collision-contributing-factors">Collision-Contributing Factors</h3>
<!-- insert the studied tables -->

<table>
  <thead>
    <tr>
      <th><strong>Crash Factors</strong></th>
      <th><strong>Target</strong></th>
      <th><strong>Values</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time</strong></td>
      <td>AV</td>
      <td>Daylight (43.75%), Dark (56.25%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Daylight (67.3%), Unknown (32.7%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Daylight (64.52%), Dark street lights (33.33%), Dusk-dawn (2.15%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Daylight (45%), Other (43%), Dark night (9%), Dusk-dawn (3%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Bicycle</td>
      <td>Good daytime lighting (46.4%), Poor daytime lighting (15.4%), Poor lighting at night (28.5%), Poor lighting at night (9.7%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Daylight (52.2%), Dark (30.1%), Dusk or Dawn (17.8%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Daytime (77.2%), Nighttime w/ Lighting (18.3%), Nighttime wo/ Lighting (4.5%)</td>
    </tr>
    <tr>
      <td><strong>Collision Type</strong></td>
      <td>AV</td>
      <td>Rear-end: (59.38%), Other (40.63%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Front (25.7%), Left (25.1%), Rear (21.2%), Right (21%), Top (4.5%), Bottom (2.4%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Rear-end (64%), Sideswipe (15%), Broadside (12%), Head-on (12%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Rear-end (61.1%), Sideswipe (24.8%), Other (6.2%), Broadside (5.3%), Head-on (2.7%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Rear-end (49.85%), Sideswipe (20.64%), Head-on (10.86%), Broadside (6.57%), Bike/Pedestrian (6.7%), Hit object (5.81%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Other (45%), Rear-end (38%), Sideswipe (11%), Head-on (3%), Hit-object (3%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Pedestrian</td>
      <td>Frontal impact (43.8%), Side impact (24.1%), Car moving forward (23.2%), Back (6.2%), No impact (3.6%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Bicycle</td>
      <td>For bicycle: Side (54.7%), Frontal (19.9%), Scrape (14.2%), Rear-end (8.2%), Others (3%), For vehicle: Left hood (24.3%), Frontal hood (17.6%), Right hood (26.7%), Left back (4.1%), Back (3%), Right back (2.6%), Left body (9.7%), Right body (12%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Front (64.4%), Right (19.4%), Left (10.6%), Rear (5.6%)</td>
    </tr>
    <tr>
      <td><strong>Speed</strong></td>
      <td>AV</td>
      <td>≤25mph (88.54%), &gt;25mph (21.88%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>[0,15] (31.8%), [15,30] (17.3%), [30,45] (16.2%), [45,60] (16.2%), [60,75] (15%), [75,90] (2.9%), [90,105] (0.6%) m/s</td>
    </tr>
    <tr>
      <td> </td>
      <td>Pedestrian</td>
      <td>2-10m/s (50.8%), 10-20m/s (42.9%), 20-30m/s (5.9%), &gt;30m/s (0.5%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Bicycle</td>
      <td>Speeding (33.1%)</td>
    </tr>
    <tr>
      <td><strong>Weather</strong></td>
      <td>AV</td>
      <td>Clear weather (88.54%), Cloudy (5.21%), Raining (3.13%), Fog/Visibility (2.08%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Clear (77.42%), Cloudy (19.35%), Raining (12.15%), Fog (1.08%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Clear (48%), Other (44%), Cloudy (5%), Raining (2%), Fog (1%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Bicycle</td>
      <td>Sunny (70.87%), Rain (15.72%), Fog (7.11%), Snow (2.6%), Rain (3.7%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Clear (68.9%), Rain/Snow/Fog (16.7%), Cloudy (14.4%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Visibility fine (82.8%), Visibility reduced (14.9%), Other (2.3%)</td>
    </tr>
    <tr>
      <td><strong>Accident Location</strong></td>
      <td>AV</td>
      <td>Road Type: Intersection (65.63%), Street Width: ≤60 feet (78.13%), Trees: 80.21%</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Highway/Freeway (32.0%), Unknown (37.6%), Intersection (13.6%), Street (13.4%), Rural road (2.2%), Parking lot (1.3%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Intersection (47.31%), Street (35.48%), Highway (13.98%), Parking lot (3.23%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Intersection (73.5%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Intersections (69.72%), Street (21.71%), Expressway (4.74%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Bicycle</td>
      <td>Road Type: Straight road (23.9%), Ramp (9.4%), Four-leg intersection (45.6%), Three-leg intersection (21.1%), Single-lane (5.6%), Two-lane two-way (7.8%), Four-lane two-way (24.4%), Six-lane, two-way (62.2%), Road condition: Dry (78.9%), Wet (16.7%), Water (4.4%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Urban (79%), Rural (21%), Road condition: Dry road surface (31%), Slippery (49.6%), Wet (18.9%)</td>
    </tr>
    <tr>
      <td><strong>Vehicle State</strong></td>
      <td>AV</td>
      <td>Straight (87.50%), Turning movement (12.50%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Other (36.63%), Proceeding straight (20.89%), Unknown (19.89%), Left turn (4.95%), Changing lanes (4.41%), Right turn (1.98%), Backing (1.89%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Stopped (36.08%), Proceeding straight (29.9%), Right turn (5.15%), Slowing/Stopping (10.31%), Left turn (4.12%), Changing lanes (4.12%), Parking maneuver (2.06%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Left turn (11.5%), Right turn (21.2%), No turning (66.3%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>Other (44.64%), Stopped (23.21%), Straight (15.18%), Left turn (3.57%), Right turn (2.68%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Pedestrian</td>
      <td>Vehicle moving forwards (99.11%), Parked or reversing (0.89%)</td>
    </tr>
    <tr>
      <td><strong>Collide With</strong></td>
      <td>AV</td>
      <td>Non-motor vehicles or pedestrians involved (18.75%)</td>
    </tr>
    <tr>
      <td> </td>
      <td>Pedestrian</td>
      <td>Car/taxi (90.88%), Motorcycle (3.97%), Bus (5.97%), Light goods vehicle (1.95%), Other (2.09%), Pedal cycle (1.48%), Unknown vehicle (0.06%)</td>
    </tr>
    <tr>
      <td><strong># of Vehicles</strong></td>
      <td>AV</td>
      <td>2 (87.50%), 1 (11.46%), 3 (1.04%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>2 (90.3%), 1 (8%), 3 (1.8%)</td>
    </tr>
    <tr>
      <td> </td>
      <td> </td>
      <td>2 (84.16%), 1 (12.87%)</td>
    </tr>
  </tbody>
</table>

<!-- 

| **Crash Factors** | **Target** | **Values** |
| ----------------- | ---------- | ---------- |
| **Time**          | AV         | Daylight (43.75%), Dark (56.25%) [\cite{divergent_effect}] |
|                   |            | Daylight (67.3%), Unknown (32.7%) [\cite{avoid}] |
|                   |            | Daylight (64.52%), Dark street lights (33.33%), Dusk-dawn (2.15%) [\cite{analysis_poi}] |
|                   |            | Daylight (45%), Other (43%), Dark night (9%), Dusk-dawn (3%) [\cite{automated_latent}] |
|                   | Bicycle    | Good daytime lighting (46.4%), Poor daytime lighting (15.4%), Poor lighting at night (28.5%), Poor lighting at night (9.7%) [\cite{car-bicycle_analysis}] |
|                   |            | Daylight (52.2%), Dark (30.1%), Dusk or Dawn (17.8%) [\cite{single_bicycle_crash}] |
|                   |            | Daytime (77.2%), Nighttime w/ Lighting (18.3%), Nighttime wo/ Lighting (4.5%) [\cite{identifying_factors}] |
| **Collision Type**| AV         | Rear-end: (59.38%), Other (40.63%) [\cite{divergent_effect}] |
|                   |            | Front (25.7%), Left (25.1%), Rear (21.2%), Right (21%), Top (4.5%), Bottom (2.4%) [\cite{avoid}] |
|                   |            | Rear-end (64%), Sideswipe (15%), Broadside (12%), Head-on (12%) [\cite{analysis_poi}] |
|                   |            | Rear-end (61.1%), Sideswipe (24.8%), Other (6.2%), Broadside (5.3%), Head-on (2.7%) [\cite{exploratory_cal}] |
|                   |            | Rear-end (49.85%), Sideswipe (20.64%), Head-on (10.86%), Broadside (6.57%), Bike/Pedestrian (6.7%), Hit object (5.81%) [\cite{learn_crash}] |
|                   |            | Other (45%), Rear-end (38%), Sideswipe (11%), Head-on (3%), Hit-object (3%) [\cite{automated_latent}] |
|                   | Pedestrian | Frontal impact (43.8%), Side impact (24.1%), Car moving forward (23.2%), Back (6.2%), No impact (3.6%) [\cite{typical_pedestrian}] |
|                   | Bicycle    | For bicycle: Side (54.7%), Frontal (19.9%), Scrape (14.2%), Rear-end (8.2%), Others (3%), For vehicle: Left hood (24.3%), Frontal hood (17.6%), Right hood (26.7%), Left back (4.1%), Back (3%), Right back (2.6%), Left body (9.7%), Right body (12%) [\cite{car-bicycle_analysis}] |
|                   |            | Front (64.4%), Right (19.4%), Left (10.6%), Rear (5.6%) [\cite{identifying_factors}] |
| **Speed**         | AV         | ≤25mph (88.54%), >25mph (21.88%) [\cite{divergent_effect}] |
|                   |            | [0,15] (31.8%), [15,30] (17.3%), [30,45] (16.2%), [45,60] (16.2%), [60,75] (15%), [75,90] (2.9%), [90,105] (0.6%) m/s [\cite{avoid}] |
|                   | Pedestrian | 2-10m/s (50.8%), 10-20m/s (42.9%), 20-30m/s (5.9%), >30m/s (0.5%) [\cite{pedestrian_causation}] |
|                   | Bicycle    | Speeding (33.1%) [\cite{car-bicycle_analysis}] |
| **Weather**       | AV         | Clear weather (88.54%), Cloudy (5.21%), Raining (3.13%), Fog/Visibility (2.08%) [\cite{divergent_effect}] |
|                   |            | Clear (77.42%), Cloudy (19.35%), Raining (12.15%), Fog (1.08%) [\cite{analysis_poi}] |
|                   |            | Clear (48%), Other (44%), Cloudy (5%), Raining (2%), Fog (1%) [\cite{automated_latent}] |
|                   | Bicycle    | Sunny (70.87%), Rain (15.72%), Fog (7.11%), Snow (2.6%), Rain (3.7%) [\cite{car-bicycle_analysis}] |
|                   |            | Clear (68.9%), Rain/Snow/Fog (16.7%), Cloudy (14.4%) [\cite{identifying_factors}] |
|                   |            | Visibility fine (82.8%), Visibility reduced (14.9%), Other (2.3%) [\cite{single_bicycle_crash}] |
| **Accident Location** | AV     | Road Type: Intersection (65.63%), Street Width: ≤60 feet (78.13%), Trees: 80.21% [\cite{divergent_effect}] |
|                   |            | Highway/Freeway (32.0%), Unknown (37.6%), Intersection (13.6%), Street (13.4%), Rural road (2.2%), Parking lot (1.3%) [\cite{avoid}] |
|                   |            | Intersection (47.31%), Street (35.48%), Highway (13.98%), Parking lot (3.23%) [\cite{analysis_poi}] |
|                   |            | Intersection (73.5%) [\cite{exploratory_cal}] |
|                   |            | Intersections (69.72%), Street (21.71%), Expressway (4.74%) [\cite{learn_crash}] |
|                   | Bicycle    | Road Type: Straight road (23.9%), Ramp (9.4%), Four-leg intersection (45.6%), Three-leg intersection (21.1%), Single-lane (5.6%), Two-lane two-way (7.8%), Four-lane two-way (24.4%), Six-lane, two-way (62.2%), Road condition: Dry (78.9%), Wet (16.7%), Water (4.4%) [\cite{identifying_factors}] |
|                   |            | Urban (79%), Rural (21%), Road condition: Dry road surface (31%), Slippery (49.6%), Wet (18.9%) [\cite{single_bicycle_crash}] |
| **Vehicle State** | AV         | Straight (87.50%), Turning movement (12.50%) [\cite{divergent_effect}] |
|                   |            | Other (36.63%), Proceeding straight (20.89%), Unknown (19.89%), Left turn (4.95%), Changing lanes (4.41%), Right turn (1.98%), Backing (1.89%) [\cite{avoid}] |
|                   |            | Stopped (36.08%), Proceeding straight (29.9%), Right turn (5.15%), Slowing/Stopping (10.31%), Left turn (4.12%), Changing lanes (4.12%), Parking maneuver (2.06%) [\cite{analysis_poi}] |
|                   |            | Left turn (11.5%), Right turn (21.2%), No turning (66.3%) [\cite{exploratory_cal}] |
|                   |            | Other (44.64%), Stopped (23.21%), Straight (15.18%), Left turn (3.57%), Right turn (2.68%) [\cite{automated_latent}] |
|                   | Pedestrian | Vehicle moving forwards (99.11%), Parked or reversing (0.89%) [\cite{typical_pedestrian}] |
| **Collide With**  | AV         | Non-motor vehicles or pedestrians involved (18.75%) [\cite{divergent_effect}] |
|                   | Pedestrian | Car/taxi (90.88%), Motorcycle (3.97%), Bus (5.97%), Light goods vehicle (1.95%), Other (2.09%), Pedal cycle (1.48%), Unknown vehicle (0.06%) [\cite{typical_pedestrian}] |
| **# of Vehicles** | AV         | 2 (87.50%), 1 (11.46%), 3 (1.04%) [\cite{divergent_effect}] |
|                   |            | 2 (90.3%), 1 (8%), 3 (1.8%) [\cite{exploratory_cal}] |
|                   |            | 2 (84.16%), 1 (12.87%) -->

<h3 id="experiment-results-of-unrelated-factors">Experiment Results of Unrelated Factors</h3>
<p><img src="images/unrelated_factors.png" alt="image" /></p>

<p>“‘Actor Location’, ‘Time’, and ‘Weather’ are three factors that were not selected for the ICS discovery. The experimental results indicate that these factors did not contribute to the ICS discovery results.”</p>

<h3 id="step-sizes-of-control-parameters">Step Sizes of Control Parameters</h3>
<p><img src="images/control_parameter-step_size.png" alt="image" /></p>

<!-- 

To determine the suitable search step size for control parameters when generating inputs, we empirically examine the relationship between the number of ICSs and step sizes for each control parameter in different collision scenarios.
% Specifically, we separately test the four control parameters: $\hat{\theta}_{x}$, $\hat{\theta}_{y}$, $d$ and $s$, and observe how the number of IC events changes with different step size.
We select the most appropriate sizes for $\hat{\theta}$, $d$, and $s$ within each type of collision scenario. 
The different control parameters are run in scenarios FLB, LC, PCS, and InC because they correspond to distinct collision areas of the struck object resulting from variations in environmental settings. 
A larger step size for $\hat{\theta}$ may result in missed collisions with bicycles but not with vehicles, due to the larger potential collision area of vehicles.
\ignore{For instance, when changing the collision angle from $0^\circ$ to $-45^\circ$ with a step size of $10^\circ$, there may be a continuous series of collisions observed in the LC scenario compared to the FLB scenario. This is due to the larger possible rear collision area provided by the volume of vehicles, as opposed to bicycles or pedestrians.}
Therefore, a uniform step size cannot be applied across all scenarios, and it is necessary to consider the step size separately for each scenario.

%settins
During testing, we keep other control parameters fixed while varying the tested parameter within its defined range. We increment or decrement the tested parameter using different step values and count the resulting ICSs. To ensure fairness, we randomly select values for the other control parameters and test the relationship between the final ICS count and the step size over ten rounds, averaging the results. We use the median as the threshold to help determine the exact step value since it can be a more representative metric to guarantee sufficient ICSs with less repetition in the final results. The results are shown in Figure~\ref{fig:step_size}. Notably, for collision angles in Carla, which involves a two-dimensional vector with $x$ and $y$ components, we conduct separate tests for each component.

%results--why use the median 
For scenario FLB, we observe that when the search step size of the collision angle on the x-axis is smaller than $0.06$, the final ICS number is larger or equal to the median. 
Thus, we select the step size at $0.04$ to guarantee sufficient ICSs with less repetition.
The step size for the collision angle on the y-axis is $0.03$.
For collision distance, we choose the step size of $1$ as the steps at $2$ and $4$ match the median, risks missing ICS.
For collision speed, we select the step at $1$ since the step sizes larger than $2$ only result in $1$ ICS or even fewer, which is not ideal for ICS discovery.
Using a similar process, we have determined the appropriate step sizes for different parameters in various scenarios. Detailed values are available on our website.


For scenario FLB, we observe that when the search step size of the collision angle on the x-axis is smaller than $0.06$, the final ICS number is larger or equal to the median. 
Thus, we select the step size at $0.04$ to guarantee sufficient ICSs with less repetition.
The step size for the collision angle on the y-axis is $0.03$.
For collision distance, we choose the step size of $1$ as the steps at $2$ and $4$ match the median, risks missing ICS.
For collision speed, we select the step at $1$ since the step sizes larger than $2$ only result in $1$ ICS or even fewer, which is not ideal for ICS discovery.
Using a similar process, we have determined the appropriate step sizes for different parameters in various scenarios. Detailed values are available on our website. -->

<p>Based on a similar process, for scenario LC, we have selected the following step sizes: $0.05$ for the angle at $x$-axis, $0.04$ for the angle at $y$-axis, $1$ for the collision distance, and $1$ for the speed step.
For the scenario PSF, we have selected the following step sizes: $0.03$ for the angle at $x$-axis, $0.03$ for the angle at $y$-axis, $1$ for the collision distance, and $1$ for the speed step.
For the scenario InC, we have selected the following step sizes: $0.05$ for the angle at $x$-axis, $0.02$ for the angle at $y$-axis, $4$ for the collision distance, and $1$ for the speed step.
The step size of collision distance for the scenario InC is because of the scenario specialties. 
To create the collision at the intersection, the distance between the initial location of the two vehicles is far since they are located at the ends of two vertical roads. 
If the EV were to change its driving behavior when it is close to NPC, it is highly possible to miss it since they are driving on perpendicular roads.
Thus, we select the step size of collision distance to $4$ and explore the relationship with the final ICS occurrences.</p>

<!-- 



## Build the Theme

Follow these instructions to build the theme.

### 1. Download the theme

First, download or clone the theme from the [Github repo](https://github.com/tomjoht/documentation-theme-jekyll). Most likely you won't be pulling in updates once you start customizing the theme, so downloading the theme (instead of cloning it) probably makes the most sense. In Github, click the **Clone or download** button, and then click **Download ZIP**.

### 2. Install Jekyll

If you've never installed or run a Jekyll site locally on your computer, follow these instructions to install Jekyll:

* [Install Jekyll on Mac][mydoc_install_jekyll_on_mac]
* [Install Jekyll on Windows][mydoc_install_jekyll_on_windows]

### 3. Install Bundler

In case you haven't installed Bundler, install it:

```
gem install bundler
```

You'll want [Bundler](http://bundler.io/) to make sure all the Ruby gems needed work well with your project. Bundler sorts out dependencies and installs missing gems or matches up gems with the right versions based on gem dependencies.

### 4. Option 1: Build the Theme (*without* the github-pages gem) {#option1}

Use this option if you're not planning to publish your Jekyll site using [Github Pages](https://pages.github.com/).

Bundler's Gemfile specifies how project dependencies are managed. Although this project includes a Gemfile, this theme doesn't have any dependencies beyond core Jekyll. The Gemfile is used to list gems needed for publishing on Github Pages. **If you're not planning to have Github Pages build your Jekyll project, delete these two files from the theme's root directory:**

* Gemfile
* Gemfile.lock

If you've never run Jekyll on your computer (you can check with `jekyll --version`), you may need to install the jekyll gem:

```
gem install jekyll
```

Now run jekyll serve (first change directories (`cd`) to where you downloaded the project):

```
jekyll serve
```

### 4. Option 2: Build the Theme (*with* the github-pages gem) {#option2}

If you *are* in fact publishing on Github Pages, leave the Gemfile and Gemfile.lock files in the theme.The Gemfile tells Jekyll to use the github-pages gem. **However, note that you cannot use the normal `jekyll serve` command with this gem due to dependency conflicts between the latest version of Jekyll and Github Pages** (which are noted [briefly here](https://help.github.com/articles/setting-up-your-github-pages-site-locally-with-jekyll/)).

You need Bundler to resolve these dependency conflicts. Use Bundler to install all the needed Ruby gems:

```
bundle update
```

Then *always* use this command to build Jekyll:

```
bundle exec jekyll serve
```

If you want to shorten this long command, you can put this code in a file such as jekyll.sh (on a Mac) and then simply type `. jekyll.sh` to build Jekyll.

## Running the site in Docker

You can also use Docker to directly build and run the site on your local machine. Just clone the repo and run the following from your working dir:
```
docker-compose build --no-cache && docker-compose up
```
The site should now be running at [http://localhost:4000/](http://localhost:4000/).

This is perhaps the easiest way to see how your site would actually look.

## Configure the sidebar

There are several products in this theme. Each product uses a different sidebar. This is the essence of what makes this theme unique -- different sidebars for different product documentation. The idea is that when users are reading documentation for a specific product, the sidebar navigation should be specific to that product. (You can read more of my thoughts on why multiple sidebars are important in this [blog post](http://idratherbewriting.com/2016/03/23/release-of-documentation-theme-for-jekyll-50/).)

The top navigation usually remains the same, because it allows users to navigate across products. But the sidebar navigation adapts to the product.

In each page's frontmatter, you must specify the sidebar you want that page to use. Here's an example of the page frontmatter showing the sidebar property:

<pre>
---
title: Alerts
tags: [formatting]
keywords: notes, tips, cautions, warnings, admonitions
last_updated: July 3, 2016
summary: "You can insert notes, tips, warnings, and important alerts in your content. These notes are stored as shortcodes made available through the linksrefs.hmtl include."
<span class="red">sidebar: mydoc_sidebar</span>
permalink: mydoc_alerts
---
</pre>

The `sidebar: mydoc_sidebar` refers to the \_data/sidebars/mydoc_sidebar.yml file.

Note that your sidebar can only have 2 levels (expand the **Tag archives** option to see an example of the second level). Given that each product has its own sidebar, this depth should be sufficient (it's really like 3 levels). Deeper nesting goes against usability recommendations.

You can optionally turn off the sidebar on any page (e.g. landing pages). To turn off the sidebar for a page, you should set the page frontmatter tag as `hide_sidebar: true`.

If you don't declare a sidebar, the `home_sidebar` file gets used as the default because this is the default specified in the config file:

```yaml
-
  scope:
    path: ""
    type: "pages"
  values:
    layout: "page"
    comments: true
    search: true
    sidebar: home_sidebar
    topnav: topnav
```

If you want to set different sidebar defaults based on different folders for your pages, specify your defaults like this:

```
-
  scope:
    path: "pages/mydoc"
    type: "pages"
  values:
    layout: "page"
    comments: true
    search: true
    sidebar: mydoc_sidebar
    topnav: topnav
```

This would load the `mydoc_sidebar` for each file in **pages/mydoc**. You could set different defaults for different path scopes.

For more detail on the sidebar, see [Sidebar navigation][mydoc_sidebar_navigation].

## Top navigation

The top navigation works just like the sidebar. You can specify which topnav data file should load by adding a `topnav` property in your page, like this:

```yaml
topnav: topnav
```

Here the topnav refers to the `_data/topnav.yml` file.

Because most topnav options will be the same, the `_config.yml` file specifies the topnav file as a default:

```yaml
-
  scope:
    path: ""
    type: "pages"
  values:
    layout: "page"
    comments: true
    search: true
    sidebar: home_sidebar
    topnav: topnav
```

## Sidebar syntax

The sidebar data file uses a specific YAML syntax that you must follow. Follow the sample pattern shown in the theme, specically looking at `mydoc_sidebar.yml` as an example: Here's a code sample showing all levels:

```yaml
entries:
- title: sidebar
  product: Jekyll Doc Theme
  version: 6.0
  folders:
  - title: Overview
    output: web, pdf
    folderitems:

    - title: Get started
      url: /index.html
      output: web, pdf
      type: homepage

    - title: Introduction
      url: /mydoc_introduction.html
      output: web, pdf

  - title: Release Notes
    output: web, pdf
    folderitems:

    - title: 6.0 Release notes
      url: /mydoc_release_notes_60.html
      output: web, pdf

    - title: 5.0 Release notes
      url: /mydoc_release_notes_50.html
      output: web, pdf

  - title: Tag archives
    output: web
    folderitems:

    - title: Tag archives overview
      url: /mydoc_tag_archives_overview.html
      output: web

      subfolders:
      - title: Tag archive pages
        output: web
        subfolderitems:

        - title: Formatting pages
          url: /tag_formatting.html
          output: web

        - title: Navigation pages
          url: /tag_navigation.html
          output: web

        - title: Content types pages
          url: /tag_content_types.html
          output: web
```

Each `folder` or `subfolder` must contain a `title` and `output` property. Each `folderitem` or `subfolderitem` must contain a `title`, `url`, and `output` property.

The two outputs available are `web` and `pdf`. (Even if you aren't publishing PDF, you still need to specify `output: web`).

The YAML syntax depends on exact spacing, so make sure you follow the pattern shown in the sample sidebars. See my [YAML tutorial](mydoc_yaml_tutorial) for more details about how YAML works.

<div markdown="span" class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> If you have just one character of spacing off, Jekyll won't build due to the YAML syntax error. You'll see an error message in your console that says "Error ... did not find expected key while parsing a block mapping at line 22 column 5. Error: Run jekyll build --trace for more information." If you encounter this, it usually refers to incorrect indentation or spacing in the YAML file. See the example mydoc_sidebar.yml file to see where your formatting went wrong.</div>




Each level must have at least one topic before the next level starts. You can't have a second level that contains multiple third levels without having at least one standalone topic in the second level. If you need a hierarchy that has a folder that contains other folders and no loose topics, use a blank `-` item like this:

```yaml
entries:
- title: sidebar
  product: Jekyll Doc Theme
  version: 6.0
  folders:
  - title: Overview
    output: web, pdf
    folderitems:

    -

  - title: Release Notes
    output: web, pdf
    folderitems:

    - title: 6.0 Release notes
      url: /mydoc_release_notes_60.html
      output: web, pdf

    - title: 5.0 Release notes
      url: /mydoc_release_notes_50.html
      output: web, pdf

  - title: Installation
    output: web, pdf
    folderitems:

    - title: About Ruby, Gems, Bundler, etc.
      url: /mydoc_about_ruby_gems_etc.html
      output: web, pdf

    - title: Install Jekyll on Mac
      url: /mydoc_install_jekyll_on_mac.html
      output: web, pdf

    - title: Install Jekyll on Windows
      url: /mydoc_install_jekyll_on_windows.html
      output: web, pdf
```

To accommodate the title page and table of contents in PDF outputs, each product sidebar must list these pages before any other:

```yaml
- title:
  output: pdf
  type: frontmatter
  folderitems:
  - title:
    url: /titlepage
    output: pdf
    type: frontmatter
  - title:
    url: /tocpage
    output: pdf
    type: frontmatter
```

Leave the output as `output: pdf` for these frontmatter pages so that they don't appear in the web output.

For more detail on the sidebar, see [Sidebar navigation][mydoc_sidebar_navigation] and [YAML tutorial][mydoc_yaml_tutorial].

## Comments

The theme integrates [Commento.io](https://commento.io/) for comments below pages and posts. (This commenting service doesn't inject controversial tracking ads like Disqus does.) You will need to Commento.io account + plan ($5/month) to authorize Commento with your domain (no other configuration should be required). If you don't want comments, in the \_config.yml file, change the `comments: true` properties (under `defaults`) to `comments: false` in every instance. Then in the commento.html include file (inside \_includes), the `{% unless page.comments == false %} ... {% endunless %}` logic will not insert the Commentio form.

## Relative links and offline viewing

This theme uses relative links throughout so that you can view the site offline and not worry about which server or directory you're hosting it. It's common with tech docs to push content to an internal server for review prior to pushing the content to an external server for publication. Because of the need for seamless transferrence from one host to another, the site has to use relative links.

To view pages locally on your machine (without the Jekyll preview server), they need to have the `.html` extension. The `permalink` property in the page's frontmatter (without surrounding slashes) is what pushes the files into the root directory when the site builds.

## Page frontmatter

When you write pages, include these same frontmatter properties with each page:

```yaml
---
title: "Some title"
tags: [sample1, sample2]
keywords: keyword1, keyword2, keyword3
last_updated: Month day, year
summary: "optional summary here"
sidebar: sidebarname
permalink: filename.html
---
```

(You will customize the values for each of these properties, of course.)

For titles, surrounding the title in quotes is optional, but if you have a colon in the title, you must surround the title with quotation marks. If you have a quotation mark inside the title, escape it first with a backlash `\`.

Values for `keywords` get populated into the metadata of the page for SEO.

Values for `tags` must be defined in your \_data/tags.yml list. You also need a corresponding tag file inside the tags folder pages/tags/ that follows the same pattern as the other tag files shown in the tags folder. (Jekyll won't auto-create these tag files.)

If you don't want the mini-TOC to show on a page (such as for the homepage or landing pages), add `toc: false` in the frontmatter.

The `permalink` value should be the same as your filename and include the ".html" file extension.

For more detail, see [Pages][mydoc_pages].

## Where to store your documentation topics

You can store your files for each product inside subfolders following the pattern shown in the theme. For example, product1, product2, etc, can be stored in their own subfolders inside the \_pages directory. Inside \_pages, you can store your topics inside sub-subfolders or sub-sub-folders to your heart's content. When Jekyll builds your site, it will pull the topics into the root directory and use the permalink for the URL.

Note that product1, product2, and mydoc are all just sample content to demonstrate how to add multiple products into the theme. You can freely delete that content.

For more information, see [Pages][mydoc_pages] and [Posts][mydoc_posts].

## Configure the top navigation

The top navigation bar's menu items are set through the \_data/topnav.yml file. Use the top navigation bar to provide links for navigating from one product to another, or to navigate to external resources.

For external URLs, use `external_url` in the item property, as shown in the example topnav.yml file. For internal links, use `url` the same was you do in the sidebar data files.

Note that the topnav has two sections: `topnav` and `topnav_dropdowns`. The topnav section contains single links, while the `topnav_dropdowns` section contains dropdown menus. The two sections are independent of each other.

## Generating PDF

If you want to generate PDF, you'll need a license for [Prince XML](http://www.princexml.com/). You will also need to [install Prince](http://www.princexml.com/doc/installing/).  You can generate PDFs by product (but not for every product on the site combined together into one massive PDF). Prince will work even without a license, but it will imprint a small Prince image on the first page, and you're supposed to buy the license to use it.

If you're on Windows, install [Git Bash client](https://git-for-windows.github.io/) rather than using the default Windows command prompt.

Open up the css/printstyles.css file and customize the email address (`youremail@domain.com`) that is listed there. This email address appears in the bottom left footer of the PDF output. You'll also need to create a PDF configuration file following the examples shown in the pdfconfigs folder, and also customize some build scripts following the same pattern shown in the root: pdf-product1.sh

See the section on [Generating PDFs][mydoc_generating_pdfs] for more details about setting the theme up for this output.

## Blogs / News

For blog posts, create your markdown files in the \_posts folder following the sample formats. Post file names always begin with the date (YYYY-MM-DD-title).

The news/news.html file displays the posts, and the news_archive.html file shows a yearly history of posts. In documentation, you might use the news to highlight product features outside of your documentation, or to provide release notes and other updates.

See [Posts][mydoc_posts] for more information.

## Markdown

This theme uses [kramdown markdown](http://kramdown.gettalong.org/). kramdown is similar to Github-flavored Markdown, except that when you have text that intercepts list items, the spacing of the intercepting text must align with the spacing of the first character after the space of a numbered list item. Basically, with your list item numbering, use two spaces after the dot in the number, like this:

```
1.  First item
2.  Second item
3.  Third item
```

When you want to insert paragraphs, notes, code snippets, or other matter in between the list items, use four spaces to indent. The four spaces will line up with the first letter of the list item (the <b>F</b>irst or <b>S</b>econd or <b>T</b>hird).

```
1.  First item

    ```
    alert("hello");
    ```

2.  Second item

    Some pig!

3.  Third item
```

See the topics under "Formatting" in the sidebar for more information.

## Automated links

If you want to use an automated system for managing links, see [Automated Links][mydoc_hyperlinks.html#automatedlinks]. This approach automatically creates a list of Markdown references to simplify linking.

## Other instructions

The content here is just a getting started guide only. For other details in working with the theme, see the various sections in the sidebar.








[news]: news.html




[mydoc_introduction]: mydoc_introduction.html




[p1_landing_page]: p1_landing_page.html




[p2_landing_page]: p2_landing_page.html












[titlepage]: titlepage.html




[tocpage]: tocpage.html






[p1_landing_page]: p1_landing_page.html




[p1_sample1]: p1_sample1.html




[p1_sample2]: p1_sample2.html




[p1_sample3]: p1_sample3.html






[p1_sample4]: p1_sample4.html




[p1_sample5]: p1_sample5.html




[p1_sample6]: p1_sample6.html




[p1_sample7]: p1_sample7.html










[titlepage]: titlepage.html




[tocpage]: tocpage.html






[p2_landing_page]: p2_landing_page.html






[p2_sample1]: p2_sample1.html




[p2_sample2]: p2_sample2.html




[p2_sample3]: p2_sample3.html




[p2_sample4]: p2_sample4.html




[p2_sample5]: p2_sample5.html






[p2_sample6]: p2_sample6.html




[p2_sample7]: p2_sample7.html




[p2_sample8]: p2_sample8.html




[p2_sample9]: p2_sample9.html




[p2_sample10]: p2_sample10.html




[p2_sample11]: p2_sample11.html




[p2_sample12]: p2_sample12.html




[p2_sample13]: p2_sample13.html




[p2_sample14]: p2_sample14.html










[mydoc_hyperlinks.html#automatedlinks]: mydoc_hyperlinks.html#automatedlinks




[mydoc_hyperlinks.html#bookmarklinks]: mydoc_hyperlinks.html#bookmarklinks




[mydoc_pages.html#someIdTag]: mydoc_pages.html#someIdTag

















 -->


    <div class="tags">
        
    </div>


<div id="commento"></div>
<script src="https://cdn.commento.io/js/commento.js"></script>
<noscript>Please enable JavaScript to load the comments.</noscript>






</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2024 Copyright 2021 Google LLC. All rights reserved. <br />
 Site last generated: Jul 24, 2024 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>






        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-66296557-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>





</html>


